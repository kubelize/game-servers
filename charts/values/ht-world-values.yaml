# Hytale Game World Server Values
# Template for individual game world servers
# Players are referred here from the lobby

replicaCount: 1

# Use StatefulSet for world servers (stable network identity and storage)
# This gives each replica its own PVC and predictable pod name:
#   hytale-survival-0, hytale-survival-1, hytale-survival-2
useStatefulSet: true

image:
  repository: kubelize/game-servers
  pullPolicy: Always
  tag: "0.2.8-ht-alpha"

imagePullSecrets: []
nameOverride: "hytale-survival"  # Change per world: survival, creative, minigames, etc.
fullnameOverride: "hytale-survival"

serverPasswordSecret:
  useExisting: false
  existingSecretName: ""

# Game worlds need more storage for player data and chunks
persistence:
  enabled: true
  storageClassName: "proxmox"
  accessMode: ReadWriteOnce
  size: 20Gi  # Larger for world data

serverConfig:
  # ===== Core Settings =====
  TZ: "UTC"
  DEBUG: "FALSE"
  PROD: "FALSE"
  SERVER_PORT: "5521"  # Different port per world
  SERVER_IP: "0.0.0.0"
  JAVA_ARGS: "-Xms4G -Xmx8G"

  # ===== Hytale Cache Settings =====
  HYTALE_CACHE: "FALSE"
  HYTALE_CACHE_DIR: "./Server/HytaleServer.aot"

  # ===== Auto-Update Settings =====
  HYTALE_AUTO_UPDATE: "TRUE"  # Check for and download game updates on server start

  # ===== Authentication & Access =====
  HYTALE_ACCEPT_EARLY_PLUGINS: "FALSE"
  HYTALE_ALLOW_OP: "TRUE"  # Allow ops to manage
  HYTALE_AUTH_MODE: ""  # authenticated (default)
  HYTALE_IDENTITY_TOKEN: ""
  HYTALE_SESSION_TOKEN: ""
  HYTALE_OWNER_NAME: "Kubeagon"
  HYTALE_OWNER_UUID: "014fefc5-2229-4ed7-92b4-4e54d2321024"

  # ===== Backup Configuration =====
  HYTALE_BACKUP: "TRUE"
  HYTALE_BACKUP_DIR: "./backups"
  HYTALE_BACKUP_FREQUENCY: "60"  # Every hour for game worlds
  HYTALE_BACKUP_MAX_COUNT: "10"

  # ===== Server Options =====
  HYTALE_BARE: "FALSE"
  HYTALE_BOOT_COMMAND: ""
  HYTALE_CLIENT_PID: ""
  HYTALE_DISABLE_ASSET_COMPARE: "FALSE"
  HYTALE_DISABLE_CPB_BUILD: "FALSE"
  HYTALE_DISABLE_FILE_WATCHER: "FALSE"
  HYTALE_DISABLE_SENTRY: "TRUE"
  HYTALE_EVENT_DEBUG: "FALSE"
  HYTALE_FORCE_NETWORK_FLUSH: "true"

  # ===== Schema & Validation =====
  HYTALE_GENERATE_SCHEMA: "FALSE"
  HYTALE_VALIDATE_ASSETS: "FALSE"
  HYTALE_VALIDATE_PREFABS: ""
  HYTALE_VALIDATE_WORLD_GEN: "FALSE"
  HYTALE_SHUTDOWN_AFTER_VALIDATE: "FALSE"

  # ===== Logging =====
  HYTALE_LOG: ""

  # ===== World & Content =====
  HYTALE_MIGRATE_WORLDS: ""
  HYTALE_MIGRATIONS: ""
  HYTALE_UNIVERSE: ""
  HYTALE_WORLD_GEN: ""
  HYTALE_PREFAB_CACHE: ""

  # ===== Mods & Plugins =====
  HYTALE_MODS: ""
  HYTALE_EARLY_PLUGINS: ""

  # ===== Network & Transport =====
  HYTALE_TRANSPORT: ""  # QUIC (default)
  HYTALE_SINGLEPLAYER: "FALSE"

  # ===== Version Control =====
  HYTALE_VERSION: "FALSE"

  # ===== config.json Settings =====
  HYTALE_SERVER_NAME: "ðŸŒ² Kubelize Network - Survival"
  HYTALE_MOTD: "Explore, build, survive!"
  HYTALE_PASSWORD: ""  # Usually empty - access controlled by lobby
  HYTALE_MAX_PLAYERS: "50"
  HYTALE_MAX_VIEW_RADIUS: "12"  # 384 blocks - adjust based on performance
  HYTALE_COMPRESSION: "false"
  HYTALE_WORLD: "world"  # Main world name
  HYTALE_GAMEMODE: "Adventure"  # or "Creative"

  # ===== Web Console Settings =====
  CONSOLE_PORT: "8080"  # Gotty web console port

# CurseForge Mod Configuration
curseforge:
  mods:
    - server-teleporters
    # - inventory-manager-api
    - hyessentialsx
    - perfect-parries
    - elitemobs
  apiKeySecret:
    name: "curseforge-api-key"
    key: "api-key"
  releaseChannel: "release"
  autoUpdate: true
  failOnError: false
  prune: false
  gameVersionFilter: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels:
  server-type: "world"
  world-name: "survival"  # Change per world

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000

# World servers are accessed via player referral (not directly)
# Can use ClusterIP for internal-only access
gameService:
  annotations: {}
  type: LoadBalancer  # External access for cross-server teleport
  ports:
    - name: gameport-udp
      protocol: UDP
      port: 5521  # Unique port per world
      targetPort: 5521
    - name: gameport-tcp
      protocol: TCP
      port: 5521
      targetPort: 5521

webService:
  enabled: true
  type: ClusterIP
  ports:
    - name: console
      protocol: TCP
      port: 8080
      targetPort: 8080

ingress:
  enabled: false

# Game worlds need more resources
resources:
  limits:
    cpu: "4"
    memory: "8Gi"
  requests:
    cpu: "2"
    memory: "4Gi"

livenessProbe:
  enabled: false

readinessProbe:
  enabled: false


nodeSelector: {}
affinity: {}
tolerations: []
